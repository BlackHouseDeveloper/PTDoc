@page "/login"
@page "/signup"
@namespace PTDoc.Maui.Pages
@layout PTDoc.UI.Components.Layout.AuthLayout
@inherits PTDoc.UI.Pages.LoginBase
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Web

<PageTitle>@(authMode == AuthMode.Login ? "Login" : "Sign Up")</PageTitle>


<div class="auth-shell">
  <div class="auth-brand">PTDoc</div>

  <div class="auth-card" aria-live="polite">
    <header class="auth-card-header">
      <p class="auth-welcome">Welcome</p>
      <div class="auth-tabs" role="tablist">
        <button type="button"
                role="tab"
                class="auth-tab @(authMode == AuthMode.Login ? "active" : "")"
                aria-selected="@(authMode == AuthMode.Login ? "true" : "false")"
                @onclick="() => SwitchMode(AuthMode.Login)">
          Login
        </button>
        <button type="button"
                role="tab"
                class="auth-tab @(authMode == AuthMode.SignUp ? "active" : "")"
                aria-selected="@(authMode == AuthMode.SignUp ? "true" : "false")"
                @onclick="() => SwitchMode(AuthMode.SignUp)">
          Sign Up
        </button>
      </div>
    </header>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
      <div class="auth-alert" role="alert">
        <span class="auth-alert-title">@(authMode == AuthMode.Login ? "Login failed" : "Sign up failed")</span>
        <span>@errorMessage</span>
      </div>
    }

    @if (authMode == AuthMode.Login)
    {
      <EditForm Model="loginModel" OnSubmit="HandleLogin" class="auth-form" aria-busy="@isLoading">
        <DataAnnotationsValidator />

        <div class="auth-field">
          <label for="username">Username</label>
          <InputText id="username"
                     class="auth-input"
                     placeholder="Enter your username"
                     autocomplete="off"
                     @bind-Value="loginModel.Username" />
        </div>

        <div class="auth-field">
          <label for="pin">4-Digit PIN</label>
          <InputText id="pin"
                     type="password"
                     class="auth-input"
                     placeholder="Enter 4-digit PIN"
                     autocomplete="off"
                     maxlength="4"
                     aria-describedby="pin-error"
                     @bind-Value="loginModel.Pin" />
          <ValidationMessage id="pin-error" For="@(() => loginModel.Pin)" class="auth-validation" />
        </div>

        <div class="auth-actions">
          <button type="button" class="auth-link" disabled="@isLoading">Forgot PIN?</button>
        </div>

        <button type="button" class="auth-primary" disabled="@isLoading" @onclick="HandleLogin">
          @if (isLoading)
          {
            <span>Authenticating...</span>
          }
          else
          {
            <span>Login</span>
          }
        </button>
      </EditForm>
    }
    else
    {
      <EditForm Model="signUpModel" OnValidSubmit="HandleSignUp" class="auth-form" aria-busy="@isLoading">
        <DataAnnotationsValidator />

        <div class="auth-field">
          <label for="fullName">
            Full Legal Name
            <span class="auth-required" aria-label="required">*</span>
            <span class="auth-info-icon" title="Enter your full legal name (first and last name) exactly as it appears on your professional license">‚ìò</span>
          </label>
          <InputText id="fullName"
                     class="auth-input"
                     placeholder="e.g., Sarah Johnson"
                     autocomplete="name"
                     @bind-Value="signUpModel.FullName" />
          <ValidationMessage For="@(() => signUpModel.FullName)" class="auth-validation" />
        </div>

        <div class="auth-field">
          <label for="dateOfBirth">
            Date of Birth
            <span class="auth-required" aria-label="required">*</span>
            <span class="auth-info-icon" title="You must be at least 18 years old to create an account">‚ìò</span>
          </label>
          <InputDate id="dateOfBirth"
                     class="auth-input"
                     placeholder="Select your date of birth"
                     @bind-Value="signUpModel.DateOfBirth" />
          <ValidationMessage For="@(() => signUpModel.DateOfBirth)" class="auth-validation" />
        </div>

        <div class="auth-field">
          <label for="email">
            Professional Email Address
            <span class="auth-required" aria-label="required">*</span>
          </label>
          <InputText id="email"
                     type="email"
                     class="auth-input"
                     placeholder="email@example.com"
                     autocomplete="email"
                     @bind-Value="signUpModel.Email" />
          <ValidationMessage For="@(() => signUpModel.Email)" class="auth-validation" />
        </div>

        <div class="auth-field">
          <label for="licenseType">
            License Type
            <span class="auth-required" aria-label="required">*</span>
            <span class="auth-info-icon" title="Select PT (Physical Therapist) or PTA (Physical Therapist Assistant)">‚ìò</span>
          </label>
          <InputSelect id="licenseType"
                       class="auth-input auth-select"
                       @bind-Value="signUpModel.LicenseType">
            <option value="">Select license type</option>
            <option value="PT">PT (Physical Therapist)</option>
            <option value="PTA">PTA (Physical Therapist Assistant)</option>
          </InputSelect>
          <ValidationMessage For="@(() => signUpModel.LicenseType)" class="auth-validation" />
        </div>

        <div class="auth-field">
          <label for="licenseNumber">
            License Number
            <span class="auth-required" aria-label="required">*</span>
            <span class="auth-info-icon" title="Enter your PT/PTA license number exactly as shown on your license">‚ìò</span>
          </label>
          <InputText id="licenseNumber"
                     class="auth-input"
                     placeholder="e.g., PT123456 or PTA-2024-001234"
                     @bind-Value="signUpModel.LicenseNumber" />
          <ValidationMessage For="@(() => signUpModel.LicenseNumber)" class="auth-validation" />
        </div>

        <div class="auth-field">
          <label for="licenseState">
            License State
            <span class="auth-required" aria-label="required">*</span>
            <span class="auth-info-icon" title="Select the U.S. state where your PT/PTA license was issued">‚ìò</span>
          </label>
          <InputSelect id="licenseState"
                       class="auth-input auth-select"
                       @bind-Value="signUpModel.LicenseState">
            <option value="">Select state</option>
            @foreach (var state in UsStates)
            {
              <option value="@state.Code">@state.Name</option>
            }
          </InputSelect>
          <ValidationMessage For="@(() => signUpModel.LicenseState)" class="auth-validation" />
        </div>

        <div class="auth-info-alert">
          <span class="auth-info-icon">‚ÑπÔ∏è</span>
          <div class="auth-info-content">
            <strong>License Verification:</strong>
            <p>Your credentials will be automatically generated after sign-up. In a production environment, license information would be verified against state licensing boards.</p>
          </div>
        </div>

        <button type="submit" class="auth-primary" disabled="@isLoading">
          @if (isLoading)
          {
            <span>Creating Account...</span>
          }
          else
          {
            <span>Create Professional Account</span>
          }
        </button>

        <p class="auth-disclaimer">
          By creating an account, you agree to maintain HIPAA compliance and professional standards.
        </p>
      </EditForm>
    }
  </div>

  <footer class="auth-footnote" aria-live="polite">
    <span>üîí HIPAA-compliant secure access</span>
    <span>Protected health information</span>
  </footer>
</div>
