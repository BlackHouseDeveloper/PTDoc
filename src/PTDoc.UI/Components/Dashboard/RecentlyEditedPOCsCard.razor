@* Recently Edited POCs Card - Shows plans of care currently being edited *@

<div class="card recently-edited-pocs-card">
    <div class="card-header">
        <div class="card-header-left">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M9.33333 2H4C3.64638 2 3.30724 2.14048 3.05719 2.39052C2.80714 2.64057 2.66667 2.97971 2.66667 3.33333V12.6667C2.66667 13.0203 2.80714 13.3594 3.05719 13.6095C3.30724 13.8595 3.64638 14 4 14H12C12.3536 14 12.6928 13.8595 12.9428 13.6095C13.1929 13.3594 13.3333 13.0203 13.3333 12.6667V6L9.33333 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9.33333 2V6H13.3333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3 class="card-title">Recently Edited POCs</h3>
        </div>
        <button type="button" class="view-all-link" aria-label="View all POCs">
            View All
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M4.5 9L7.5 6L4.5 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>
    
    <div class="card-content">
        @if (_pocs == null || !_pocs.Any())
        {
            <div class="empty-state">
                <p class="empty-state-text">No recently edited POCs</p>
            </div>
        }
        else
        {
            <div class="pocs-list">
                @foreach (var poc in _pocs)
                {
                    <div class="poc-item">
                        <div class="poc-header">
                            <div class="poc-patient-info">
                                <span class="poc-patient-name">@poc.PatientName</span>
                                <span class="poc-status-badge poc-status-@poc.Status.ToLower()">@poc.Status</span>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline" aria-label="View POC for @poc.PatientName">
                                View
                            </button>
                        </div>
                        
                        <div class="poc-id">POC @poc.Id â€¢ @poc.DaysOld days @poc.TimeFrame</div>
                        
                        <div class="poc-metrics">
                            <div class="poc-metric">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6 3V6L8 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Wk @poc.WeekCurrent/@poc.WeekTotal</span>
                            </div>
                            
                            <div class="poc-metric poc-metric-@(poc.VisitsCurrent >= poc.VisitsTotal ? "complete" : "progress")">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    @if (poc.VisitsCurrent >= poc.VisitsTotal)
                                    {
                                        <path d="M10 3L4.5 8.5L2 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    }
                                    else
                                    {
                                        <path d="M6 2V6L8 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    }
                                </svg>
                                <span>@poc.VisitsCurrent/@poc.VisitsTotal</span>
                            </div>
                            
                            <div class="poc-metric">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M6 1V6L8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                <span>@poc.Sessions/@poc.SessionsTotal</span>
                            </div>
                            
                            <div class="poc-metric">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M11 1H1V11H11V1Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 3H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    <path d="M3 6H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>ICD @poc.IcdCount</span>
                            </div>
                        </div>
                        
                        <div class="poc-utilization">
                            <span class="utilization-label">Utilization</span>
                            <span class="utilization-value">@poc.UtilizationPercentage%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: @poc.UtilizationPercentage%"></div>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(poc.Alert))
                        {
                            <div class="poc-alert poc-alert-@((poc.AlertType ?? "info").ToLowerInvariant())">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    @if (poc.AlertType == "warning")
                                    {
                                        <path d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M6 4V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M6 8H6.005" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    }
                                    else
                                    {
                                        <path d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M4.5 4.5L7.5 7.5M7.5 4.5L4.5 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    }
                                </svg>
                                @poc.Alert
                            </div>
                        }
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    private List<RecentlyEditedPOC>? _pocs;
    
    protected override void OnInitialized()
    {
        // Mock data - replace with actual service call
        _pocs = new List<RecentlyEditedPOC>
        {
            new RecentlyEditedPOC 
            { 
                Id = "POC-2024-001",
                PatientName = "Sarah Johnson",
                Status = "active",
                DaysOld = 708,
                TimeFrame = "ago",
                WeekCurrent = 7,
                WeekTotal = 12,
                VisitsCurrent = 18,
                VisitsTotal = 36,
                Sessions = 2,
                SessionsTotal = 3,
                IcdCount = 2,
                UtilizationPercentage = 50,
                Alert = null,
                AlertType = null
            },
            new RecentlyEditedPOC 
            { 
                Id = "POC-2024-002",
                PatientName = "Michael",
                Status = "expiring",
                DaysOld = 710,
                TimeFrame = "ago",
                WeekCurrent = 10,
                WeekTotal = 12,
                VisitsCurrent = 28,
                VisitsTotal = 30,
                Sessions = 3,
                SessionsTotal = 4,
                IcdCount = 2,
                UtilizationPercentage = 93,
                Alert = "2w, 2v left",
                AlertType = "warning"
            },
            new RecentlyEditedPOC 
            { 
                Id = "POC-2024-003",
                PatientName = "Emily Rodriguez",
                Status = "active",
                DaysOld = 710,
                TimeFrame = "ago",
                WeekCurrent = 4,
                WeekTotal = 8,
                VisitsCurrent = 9,
                VisitsTotal = 24,
                Sessions = 1,
                SessionsTotal = 2,
                IcdCount = 1,
                UtilizationPercentage = 38,
                Alert = "Add 1 ICD-10 code(s)",
                AlertType = "error"
            }
        };
    }
    
    private class RecentlyEditedPOC
    {
        public string Id { get; set; } = string.Empty;
        public string PatientName { get; set; } = string.Empty;
        public string Status { get; set; } = string.Empty;
        public int DaysOld { get; set; }
        public string TimeFrame { get; set; } = string.Empty;
        public int WeekCurrent { get; set; }
        public int WeekTotal { get; set; }
        public int VisitsCurrent { get; set; }
        public int VisitsTotal { get; set; }
        public int Sessions { get; set; }
        public int SessionsTotal { get; set; }
        public int IcdCount { get; set; }
        public int UtilizationPercentage { get; set; }
        public string? Alert { get; set; }
        public string? AlertType { get; set; }
    }
}
