@* Appointments Left Column - Composition Component *@

<div class="appointments-left-column">
    <AppointmentsViewTabs SelectedView="@(SelectedView == AppointmentsView.Today ? "Today" : "Week")" 
                          OnViewChanged="HandleViewChangeInternal" />
    
    <button type="button" 
            class="filters-button @(IsFiltersOpen ? "active" : "")" 
            @onclick="ToggleFilters">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 4H14M4 8H12M6 12H10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Filters</span>
        <svg class="chevron @(IsFiltersOpen ? "open" : "")" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
    
    @if (IsFiltersOpen)
    {
        <AppointmentFiltersPanel Filter="@CurrentFilter" 
                                OnFilterChanged="OnFilterChanged" />
    }
    
    <AppointmentsDaySwitcher SelectedDate="SelectedDate"
                             OnPrevDay="OnPrevDay"
                             OnNextDay="OnNextDay"
                             OnToday="OnToday" />
    
    <PatientStatusOverview TotalCount="TotalCount"
                          InProgressCount="InProgressCount"
                          CheckedInCount="CheckedInCount"
                          MissingIntakeCount="MissingIntakeCount" />
</div>

@code {
    [Parameter]
    public AppointmentsView SelectedView { get; set; } = AppointmentsView.Today;

    [Parameter]
    public EventCallback<AppointmentsView> OnViewChanged { get; set; }

    [Parameter]
    public DateTime SelectedDate { get; set; } = DateTime.Today;

    [Parameter]
    public EventCallback OnPrevDay { get; set; }

    [Parameter]
    public EventCallback OnNextDay { get; set; }

    [Parameter]
    public EventCallback OnToday { get; set; }

    [Parameter]
    public int TotalCount { get; set; } = 12;

    [Parameter]
    public int InProgressCount { get; set; } = 1;

    [Parameter]
    public int CheckedInCount { get; set; } = 1;

    [Parameter]
    public int MissingIntakeCount { get; set; } = 2;

    [Parameter]
    public bool IsFiltersOpen { get; set; } = false;

    [Parameter]
    public EventCallback<bool> IsFiltersOpenChanged { get; set; }

    [Parameter]
    public AppointmentsFilter CurrentFilter { get; set; } = new();

    [Parameter]
    public EventCallback<AppointmentsFilter> OnFilterChanged { get; set; }

    private async Task HandleViewChangeInternal(string view)
    {
        var newView = view == "Week" ? AppointmentsView.Week : AppointmentsView.Today;
        await OnViewChanged.InvokeAsync(newView);
    }

    private async Task ToggleFilters()
    {
        IsFiltersOpen = !IsFiltersOpen;
        await IsFiltersOpenChanged.InvokeAsync(IsFiltersOpen);
    }
}
