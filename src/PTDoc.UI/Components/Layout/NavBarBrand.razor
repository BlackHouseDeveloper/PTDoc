@namespace PTDoc.UI.Components.Layout
@inject IThemeService ThemeService
@inject IJSRuntime JS
@implements IDisposable

<div class="navbar-brand-container">
    <!-- PTDoc Logo Badge -->
    <div class="navbar-brand-header">
        <a href="/" class="navbar-brand-logo" aria-label="PTDoc Home">
            <div class="navbar-brand-logo-text">PTDoc</div>
        </a>
    </div>

    <!-- User Profile Section -->
    <div class="navbar-brand-profile">
        <div class="navbar-brand-profile-name">Dr. Sarah Johnson</div>
        <div class="navbar-brand-profile-info">
            <span class="navbar-brand-profile-title">Physical Therapist</span>
            <span class="navbar-brand-profile-badge" aria-label="License type">PT</span>
        </div>

        <!-- Action Buttons Row -->
        <div class="navbar-brand-actions" role="group" aria-label="Quick actions">
            <!-- Notification Bell Button -->
            <button type="button" 
                    class="navbar-brand-action-btn"
                    aria-label="Notifications"
                    title="Notifications">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M15 6.66667C15 5.34058 14.4732 4.06881 13.5355 3.13113C12.5979 2.19345 11.3261 1.66667 10 1.66667C8.67392 1.66667 7.40215 2.19345 6.46447 3.13113C5.52678 4.06881 5 5.34058 5 6.66667C5 12.5 2.5 14.1667 2.5 14.1667H17.5C17.5 14.1667 15 12.5 15 6.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11.4417 17.5C11.2952 17.7526 11.0849 17.9622 10.8319 18.1079C10.5789 18.2537 10.292 18.3304 10 18.3304C9.70803 18.3304 9.42117 18.2537 9.16816 18.1079C8.91515 17.9622 8.70486 17.7526 8.55835 17.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <!-- Theme Toggle Button -->
            <button type="button" 
                    class="navbar-brand-action-btn theme-toggle"
                    aria-label="@(isDarkTheme ? "Switch to light theme" : "Switch to dark theme")"
                    title="@(isDarkTheme ? "Switch to light theme" : "Switch to dark theme")"
                    @onclick="ToggleTheme">
                <img src="images/LightThemeIcon.svg" alt="" class="theme-icon theme-icon-light" aria-hidden="true" />
                <img src="images/DarkThemeIcon.svg" alt="" class="theme-icon theme-icon-dark" aria-hidden="true" />
            </button>
        </div>
    </div>

    <!-- Sync Status Badge -->
    <div class="navbar-brand-sync-badge" role="status" aria-live="polite">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M6 0.5C2.96243 0.5 0.5 2.96243 0.5 6C0.5 9.03757 2.96243 11.5 6 11.5C9.03757 11.5 11.5 9.03757 11.5 6C11.5 2.96243 9.03757 0.5 6 0.5Z" fill="currentColor"/>
        </svg>
        <span>Synced</span>
    </div>
</div>

@code {
    private bool isDarkTheme;

    protected override void OnInitialized()
    {
        ThemeService.OnThemeChanged += OnThemeChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await ThemeService.InitializeAsync();
            isDarkTheme = ThemeService.IsDarkMode;
            StateHasChanged();
        }
    }

    private async Task ToggleTheme()
    {
        await ThemeService.ToggleThemeAsync();
    }

    private void OnThemeChanged()
    {
        isDarkTheme = ThemeService.IsDarkMode;
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= OnThemeChanged;
    }
}
